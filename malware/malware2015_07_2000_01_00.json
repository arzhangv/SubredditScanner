{"data": [{"distinguished": null, "subreddit_id": "t5_2qrkp", "ups": 3, "created_utc": 1437457382, "controversiality": 0, "parent_id": null, "edited": false, "downs": 0, "body": "/u/909research provided a nice resource...I'll add some of my own, going light on the tools as well.\n\nStep 1: Ignore everyone that asks you to blindly start using 3rd-party tools to \"analyze\" artifacts you don't yet understand. The point is to find out what happened, not to watch tools light up. Not that tools aren't useful of course, they definitely are essential. But when you're learning, you don't want to abstract yourself from the details with push-button solutions.\n\nIf a workstation is compromised, I'll go ahead and assume that there were some indicators which led to this thing being plopped down in front of me. Was there an A/V alert? IDS rules fire? Was the device interacting with unusual resources on the internet? Is it just \"acting funny\"? How so? When? If you can get a starting point for a timeline, that's best.\n\nAcquisition is additional theory in and of itself, so I'll skip ahead to your actual question: where to start *analysis*. This can be on a write-blocked drive, or remotely with something like the Enter-PSSession cmdlet (I prefer the latter for commodity malware in cases where I know I won't be acquiring the drive, but instead reimaging and moving on).\n\nSome low-hanging fruit:\n\n-C:\\Windows\\Prefetch\\: Provides evidence of application execution. I have seen even commodity malware delete its entry from Prefetch in the past, but it's not common. If you see something suspicious here, keep it for your timeline. \"Suspicious\"  in the context of Prefetch might be (not in order of importance):\n\n    -Randomly-generated process name\n    -Seemingly Unusual process name (ie \"632.exe\")\n    -Fake process name: Perhaps it's masquerading as an Nvidia driver when you don't use Nvidia\n    -Process out of place: For example, \"svchost.exe\" executing out of temp\n\n-UserAssist registry key: If it was executed via Windows Explorer, you will see evidence of that here. Nice for proving things like \"User attempted to open the malicious document four times...\". Sidenote: I have seen someone pwn themselves four times with the same piece of malware because they thought a malicious Word document \"wasn't working\". More timeline support with this artifact as well.\n\n-ShimCache: An side-effect of the Microsoft Application Compatibility service. Provides more evidence of application execution\n\n-Windows event logs: Hopefully at this point you're aware of some type of malicious activity happening at a certain time. Using what you have in your timeline, you can peruse the Windows event logs looking for supporting and new information\n\n-As mentioned before, a tool like autoruns is a nice bit of automation - 99% of malware you'll encounter will use known persistence mechanisms, your job is to start understanding what those are\n\n-NTFS journal: NTFS is a journaling filesystem, which records changes to file/folder metadata. I have become obsessed with using the NTFS journal to further support my timeline and evidence. It's awesome. Also, it's interesting to see what a/v fails to remediate when it recognizes malicious activity. Often times I'll see antivirus go crazy and delete a ton of stuff, but leave a malicious binary sitting on in the filesystem. The NTFS journal is especially nice to show the helpdesk folks why scanning a compromised workstation isn't good enough. You can point to exactly what it identified, and failed to identify.\n\n...anyway, those are a few things to start with. Sure, you could dump memory, use Redline, Volitility and get cray - but for the vast majority of your day-in-and-day-out interactions with malware, you'll likely have SOME idea of what you're dealing with because the ecosystem of commodity malware is pretty consistent. To be clear, you don't ever want to get complacent and assume you know what you're looking at - always seek to find out what happened - but once you have some context of what you're looking for, even a small handful of forensic artifacts can go a long way.\n", "id": "ctaltgl", "gilded": 0, "removal_reason": null, "link_id": "t3_3dxosg", "author_flair_css_class": null, "subreddit": "Malware", "author": "maliciou5", "archived": false, "score_hidden": false, "score": 3, "author_flair_text": null, "retrieved_utc": 1438049022, "updated_utc": 1668796651, "body_sha1": "8c80b1dac843b57c9eeae5e9f72a5f3666c8cbf9", "nest_level": 1, "utc_datetime_str": "2015-07-21 05:43:02"}, {"author": "iCkerous", "gilded": 0, "score": 1, "id": "ctahb13", "parent_id": null, "ups": 1, "created_utc": 1437447499, "downs": 0, "body": "What are you looking to learn/gather?", "subreddit": "Malware", "archived": false, "author_flair_css_class": null, "edited": false, "removal_reason": null, "link_id": "t3_3dw041", "distinguished": null, "author_flair_text": null, "score_hidden": false, "controversiality": 0, "subreddit_id": "t5_2qrkp", "retrieved_utc": 1438045854, "updated_utc": 1668796648, "body_sha1": "5da6aafd02177fc906619ab6b9a87af88aa0077f", "nest_level": 1, "utc_datetime_str": "2015-07-21 02:58:19"}, {"subreddit_id": "t5_2qrkp", "score_hidden": false, "controversiality": 0, "author_flair_text": null, "link_id": "t3_3dxosg", "distinguished": null, "edited": false, "removal_reason": null, "author_flair_css_class": null, "archived": false, "subreddit": "Malware", "body": "1) run mandiant redline from USB to collect memory dump (at minimum) and as many of the other checkboxes as you think are interesting (filesystem, prefetch, registry are super useful)\n\n2) power down machine. Forensically image hard drive. Alternatively: grab important files as forensically sound as possible if the whole hard drive can't be imaged. When working over the network with something like encase enterprise you might just need to start with the $mft, all registry files (including ntuser.DAT files), prefetch directory/files, event logs, and internet history files.\n\n3) rip through hard drive with log2timeline/plaso\n\n4) analysis begins:\n\nHere's where it gets black arts, since every case is different. You'll want to quickly find your first \"pivot point.\" Build a comprehensive timeline and then use knowledge from whatever it is that made you suspect the machine was infected and start analyzing from there. \n\nEvil filename? Find it in the timeline and see what happened before and after the file was created to get an idea of how it got on the system and what changes happened after. \n\nEvil network connectivity in your FW or proxy logs? See what was running around the same time on the system.\n\nGot nothing? Use mandiant redline and/or volatility to rip through ram and look for suspiciousness and evil.\n\nFound some interesting things? Pull out suspect malware samples and analyze. Stick it in a sandbox and see what happens. Get good at reverse engineering and static analysis and see what's what. Get simple and run *strings* on it, even.\n\nGot packed/encrypted malware on disk? Dump \"running\" samples straight from the memory image you took.\n\nOnce you've figured out how the machine was infected and what the malware did (accessed, changed, etc), write a report and send it on. The goal is to escalate if critical data/systems were exposed to evil doers **and** pretend to he captain hindsight with recommendations of how to prevent similar events in the future.\n\nThat's it in a nutshell. Mastering the various tools to perform the analysis, as well as developing the instinct of \"where to look next,\" is the hard part. It comes with experience of doing this for a while - but this is how I answer the question in interviews :P", "downs": 0, "created_utc": 1437446701, "ups": 2, "id": "ctagv6i", "parent_id": null, "gilded": 0, "score": 2, "author": "threeLetterMeyhem", "retrieved_utc": 1438045538, "updated_utc": 1668796648, "body_sha1": "a13b4491ac53364e226b81d809e0e9df85a2a166", "nest_level": 1, "utc_datetime_str": "2015-07-21 02:45:01"}, {"distinguished": null, "link_id": "t3_3dxosg", "author_flair_text": null, "removal_reason": null, "edited": false, "author_flair_css_class": null, "subreddit_id": "t5_2qrkp", "controversiality": 0, "score_hidden": false, "ups": 1, "created_utc": 1437441181, "gilded": 0, "score": 1, "author": "im_not_that_clever", "parent_id": 27891097336, "id": "ctadpi1", "subreddit": "Malware", "archived": false, "downs": 0, "body": "awesome! Cannot wait for part 2!", "retrieved_utc": 1438043100, "updated_utc": 1668796645, "body_sha1": "508ccf1ea9685d42db64a92301b66484df174bee", "utc_datetime_str": "2015-07-21 01:13:01"}, {"subreddit": "Malware", "id": "ctacwfk", "removal_reason": null, "author": "kizdog", "score_hidden": false, "controversiality": 0, "gilded": 0, "score": 1, "ups": 1, "body": "&gt; I've always wondered given an OS with adequate protection suite such as host IPS or antivirus, it would help sysadmins or ITsec folks a head start in what to look for with alerts and log files. \n\nThe process of investigating endpoints based on security events should be dictated by the security team *not* the desktop team. They may leverage the desktop team to get the user off the system, isolate it from the network, but the actual investigation should come from security team. \n\nWhat do they look for first? They typically move in order of volatility of the evidence on the system. Getting a memory image may be standard, depending on the alert. Once done, collecting evidence for offline analysis is the best course of action. \n\n[Mandiant's Redline](https://www.mandiant.com/resources/download/redline) is a great tool that will automate the collection of memory as well as all other items of interest: event logs, processes, network connections, loaded DLLs, services, scheduled tasks, etc. \n\nFrom there, you start the analysis with what you know: if the alert was tripped on a file or activity, look for it in your collected evidence. Do you have a time frame? What was logged in the event log at that time? What processes were running? Via memory analysis, were there any processes that were hidden? Look at the registry: any new persistence keys? Look at the network connections: any outbound to unknown IPs? Any connections to lateral systems? \n\nThese are just a few of the things you would look at. Ultimately, you want to deduce if anything left the system or what type of lateral movement may have occurred. You also want to check all the accounts that were on the system: these are now targets. Watch for odd login activity with these accounts. ", "archived": false, "edited": false, "downs": 0, "parent_id": null, "subreddit_id": "t5_2qrkp", "author_flair_text": null, "distinguished": null, "author_flair_css_class": null, "created_utc": 1437439813, "link_id": "t3_3dxosg", "retrieved_utc": 1438042418, "updated_utc": 1668796645, "body_sha1": "88b34ad40417b1038870dbe318cd7644a38dc7e5", "nest_level": 1, "utc_datetime_str": "2015-07-21 00:50:13"}, {"subreddit_id": "t5_2qrkp", "created_utc": 1437433063, "link_id": "t3_3drbqq", "author_flair_css_class": null, "distinguished": "moderator", "author_flair_text": null, "ups": 1, "gilded": 0, "score": 1, "body": "This post is off topic for /r/Malware. Please refer to the sidebar for more information.", "removal_reason": null, "id": "cta92nf", "author": "jershmagersh", "subreddit": "Malware", "controversiality": 0, "score_hidden": false, "downs": 0, "parent_id": null, "archived": false, "edited": false, "retrieved_utc": 1438039441, "updated_utc": 1668796641, "body_sha1": "8e43ce5437c71ed5e0abbe847e9b354e9847583d", "nest_level": 1, "utc_datetime_str": "2015-07-20 22:57:43"}, {"archived": false, "gilded": 0, "subreddit": "Malware", "author_flair_css_class": null, "created_utc": 1437432271, "subreddit_id": "t5_2qrkp", "author": "apotheosis666", "controversiality": 0, "edited": false, "removal_reason": null, "author_flair_text": null, "link_id": "t3_3dw041", "score_hidden": false, "parent_id": 27890396000, "ups": 1, "score": 1, "distinguished": null, "downs": 0, "body": "ya your right wanted to toy with one in my college getting a degree in cyber security and this has been the talk for months and i cant seem to find any decent live samples of these builders not even for sale at least the ones ive seen have all been scams, \n", "id": "cta8m0e", "retrieved_utc": 1438039088, "updated_utc": 1668796640, "body_sha1": "3227b4f0a045a1b306575b4d3044a3d0600f244a", "utc_datetime_str": "2015-07-20 22:44:31"}, {"score": 1, "ups": 1, "link_id": "t3_3dxosg", "score_hidden": false, "parent_id": 27891097336, "body": "Thanks.  Bookmarked.", "id": "cta8fw4", "downs": 0, "distinguished": null, "subreddit": "Malware", "author_flair_css_class": null, "gilded": 0, "archived": false, "removal_reason": null, "edited": false, "author_flair_text": null, "controversiality": 0, "created_utc": 1437431971, "subreddit_id": "t5_2qrkp", "author": "jobobisme2002", "retrieved_utc": 1438038946, "updated_utc": 1668796640, "body_sha1": "5f4d52e3410d7002bca32d95978a9343b2363fae", "utc_datetime_str": "2015-07-20 22:39:31"}, {"parent_id": null, "id": "ct9whq4", "score": 1, "removal_reason": null, "body": "Agree with all the suggestions. I also recommend and use Mandiant Redline. It looks at a lot of different things, including processes, dlls, memory, etc. \n\nOther items to check: Windows registry Run keys (both HKCU and HKLM and even Default user), Windows Event log files, and Wireshark traffic analysis. \n\nLearn how to use Volatility (Memory is where a lot of malware hides now) and RegRipper. Both are invaluable for IR and forensics", "score_hidden": false, "distinguished": null, "author_flair_text": null, "author": "technogal", "controversiality": 0, "gilded": 0, "ups": 1, "subreddit_id": "t5_2qrkp", "subreddit": "Malware", "created_utc": 1437413740, "archived": false, "edited": false, "downs": 0, "link_id": "t3_3dxosg", "author_flair_css_class": null, "retrieved_utc": 1438029405, "updated_utc": 1668796628, "body_sha1": "1e47fb640fa538aeeb0423bc73297845a627e747", "nest_level": 1, "utc_datetime_str": "2015-07-20 17:35:40"}, {"removal_reason": null, "created_utc": 1437399515, "subreddit_id": "t5_2qrkp", "archived": false, "author_flair_css_class": null, "body": "Two tools that spring to mind:\n\n* [Process Monitor](https://technet.microsoft.com/en-us/Library/bb896645.aspx) - Look for odd processes, packed processes, etc.\n* [Autoruns](https://technet.microsoft.com/en-us/Library/bb963902.aspx) - Make sure you turn on signature verification (not a definitive thing to do, but can lead down the right paths)\n\nI recommend checking this out too:\n\n[TWC: Malware Hunting with Mark Russinovich and the Sysinternals Tools](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2014/DCIM-B368)", "subreddit": "Malware", "score": 1, "author": "trevlix", "score_hidden": false, "distinguished": null, "controversiality": 0, "ups": 1, "parent_id": null, "link_id": "t3_3dxosg", "edited": false, "author_flair_text": null, "downs": 0, "id": "ct9nsqf", "gilded": 0, "retrieved_utc": 1438022678, "updated_utc": 1668796621, "body_sha1": "cd4bcc061ffba56fd8b9929a7d5c67faabcf1059", "nest_level": 1, "utc_datetime_str": "2015-07-20 13:38:35"}], "error": null, "metadata": {"es": {"took": 174, "timed_out": false, "_shards": {"total": 824, "successful": 824, "skipped": 820, "failed": 0}, "hits": {"total": {"value": 14, "relation": "eq"}, "max_score": null}}, "es_query": {"size": 10, "query": {"bool": {"must": [{"bool": {"must": [{"range": {"created_utc": {"gte": 1437375660000}}}, {"range": {"created_utc": {"lt": 1437462060000}}}]}}, {"bool": {"should": [{"match": {"subreddit": "malware"}}], "minimum_should_match": 1}}]}}, "aggs": {}, "sort": {"created_utc": "desc"}}, "es_query2": "{\"size\":10,\"query\":{\"bool\":{\"must\":[{\"bool\":{\"must\":[{\"range\":{\"created_utc\":{\"gte\":1437375660000}}},{\"range\":{\"created_utc\":{\"lt\":1437462060000}}}]}},{\"bool\":{\"should\":[{\"match\":{\"subreddit\":\"malware\"}}],\"minimum_should_match\":1}}]}},\"aggs\":{},\"sort\":{\"created_utc\":\"desc\"}}", "api_launch_time": 1673017478.2171538, "api_request_start": 1674103854.8126924, "api_request_end": 1674103855.0296576, "api_total_time": 0.2169651985168457}}