{"data": [{"score_hidden": false, "subreddit_id": "t5_2qrkp", "score": 1, "parent_id": null, "id": "cnrpd75", "gilded": 0, "edited": false, "distinguished": null, "body": "http://www.secureworks.com/cyber-threat-intelligence/threats/skeleton-key-malware-analysis/Look at the skeleton key malware it does something similar. Malfind wont find the injected code unless the protection is executable or the injected code has 'MZ' signature for a executable. If malware is just injecting a patch and not a executable of some sort i dont think malfind will catch it. I guess you would have to create a yara signature for the injected code and scan memory for that signature or do a diff on the injected dll/process and compare it to the memory resident copy however this will have a lot of legitimate differences also. Hope that helps.", "author": "mikiozen", "author_flair_css_class": null, "controversiality": 0, "ups": 1, "archived": false, "link_id": "t3_2snfp6", "subreddit": "Malware", "created_utc": 1421472870, "author_flair_text": null, "downs": 0, "retrieved_utc": 1424830141, "updated_utc": 1668779287, "body_sha1": "e0e58208ac816672a96bfc7b82083669e31222f8", "nest_level": 1, "utc_datetime_str": "2015-01-17 05:34:30"}, {"created_utc": 1421453313, "body": "today under HKEY_LOCAL_MACHINE\\Software\\Policies\\Microsoft\\Windows\\CurrentVersion\\Internet Settings i found ProxySettingsPerUser = 1. after i set that to 0 i could restart ie explorer without the proxy settings coming back.  Note the machine i was working on was running win 8.1", "distinguished": null, "author_flair_text": null, "id": "cnrggjs", "subreddit_id": "t5_2qrkp", "archived": false, "gilded": 0, "link_id": "t3_2skuq0", "author_flair_css_class": null, "downs": 0, "score_hidden": false, "ups": 2, "parent_id": null, "edited": false, "score": 2, "author": "gkal70", "subreddit": "Malware", "controversiality": 0, "retrieved_utc": 1424834367, "updated_utc": 1668779278, "body_sha1": "42a258f23fa9d4df3ebea126f2802f143198ccfa", "nest_level": 1, "utc_datetime_str": "2015-01-17 00:08:33"}, {"archived": false, "id": "cnrdsdz", "subreddit_id": "t5_2qrkp", "gilded": 0, "link_id": "t3_2snfp6", "author_flair_css_class": null, "downs": 0, "parent_id": null, "ups": 2, "score_hidden": false, "edited": false, "score": 2, "author": "haveatya", "subreddit": "Malware", "controversiality": 0, "created_utc": 1421448252, "body": "From what I know there isn't a way. Windows would have to keep a history of the changes made but all VirtualProtectEx knows is the current value which it replaces and returns to the caller. You would only know what the true permissions are if you were to hook the function itself in which case it would allow you to watch changes made on-the-fly.\n\nNow you could search for valid x86/AMD64 opcodes inside a memory region you suspect to have been executable at some point but that's not a fast task and you'd have to tune the search parameters to be incredibly precise (e.g. how many operations have to be continuous to consider it true executable code? what kinds of operations aren't allowed to be in the chain?) and that would most likely give a ton of false positives/negatives. Depending on the case you might also risk finding stale modules that were unloaded but haven't been overwritten so it might look suspicious but it isn't.\n\nIt's not an easy task. If so I'm sure a lot of tools would exist to find these areas.", "distinguished": null, "author_flair_text": null, "retrieved_utc": 1424835613, "updated_utc": 1668779276, "body_sha1": "f2f4f01665f2c8a0d6b5988e44b28b1785f379ea", "nest_level": 1, "utc_datetime_str": "2015-01-16 22:44:12"}, {"subreddit_id": "t5_2qrkp", "author": "bbarnes2112", "distinguished": null, "downs": 0, "score": 1, "parent_id": 27557301847, "link_id": "t3_2skuq0", "author_flair_text": null, "ups": 1, "edited": false, "subreddit": "Malware", "created_utc": 1421442208, "controversiality": 0, "score_hidden": false, "author_flair_css_class": null, "body": "d7II malware scanner does not see anything out of the norm.  Ill ask Nick at FoolishIT if he would be interested in looking into it for me. Know of a better way of analyzing EAT hooks... because the ones RogueKiller found are my only real lead. I believe they may be hiding in protected memory, then they hook and inject.  I have been trying to determine what is accessing the registry and at what point in the startup it populates the registry.  I tried locking down the registry settings and permissions for \"Internet Settings\" but they revert as well... I am not so efficient with DCOM, but I will look there and see what I find.  I did not expect this many people to have this problem all of a sudden with these windows 7 systems... and its not tuesday lol, there might be more to this.", "archived": false, "id": "cnra9a1", "gilded": 0, "retrieved_utc": 1424837322, "updated_utc": 1668779273, "body_sha1": "ddb3e9f09409dc06975d26a48c1dccc911fba3b6", "utc_datetime_str": "2015-01-16 21:03:28"}, {"distinguished": null, "author": "kmh_", "parent_id": null, "id": "cnr75gz", "archived": false, "created_utc": 1421437190, "subreddit_id": "t5_2qrkp", "link_id": "t3_2skuq0", "gilded": 0, "controversiality": 0, "body": "It seems pretty clear from your explanation that you're not seeing the persistence mechanism. Most of the tools you're trying will look for some of these, but not all of them. You're going to need to find it manually.\n\nRun the 'autoruns' utility from sysinternals. This is a simple utility that simply lists all of the ways a program can have itself run at boot or login. \n\nWhen running autoruns, pay close attention to services and registry keys (especially Run keys) pointing to strange files (these are most common in my experience). Disable them and try rebooting. Once the symptoms disappear, remove the persistence mechanism (i.e. delete the key or service) as well as the malicious file(s) manually, keeping in mind they may be hidden or have permissions set beyond your current access level (assuming the malware was run as an admin).\n\nSomething worth mentioning is that if this malware ran as admin on your machine, it's likely that you will not be able to remove it entirely without serious work (i.e. bootkit type malware).", "ups": 2, "score_hidden": false, "score": 2, "subreddit": "Malware", "author_flair_text": null, "author_flair_css_class": null, "edited": false, "downs": 0, "retrieved_utc": 1424838834, "updated_utc": 1668779270, "body_sha1": "af411f6308fecf60f09565263c21f59c63f5648d", "nest_level": 1, "utc_datetime_str": "2015-01-16 19:39:50"}, {"downs": 0, "controversiality": 0, "author_flair_css_class": null, "score_hidden": false, "distinguished": null, "author_flair_text": null, "parent_id": null, "author": "SweetDaddyJones", "archived": false, "subreddit_id": "t5_2qrkp", "created_utc": 1421423340, "gilded": 0, "id": "cnqyiai", "edited": false, "subreddit": "Malware", "score": 3, "link_id": "t3_2skuq0", "ups": 3, "body": "I ran into almost this exact same problem on a friend's computer, and was able to remove the malware, but it was a pain.  Firstly, I noted two suspicious processes in taskmgr called rcpinspiraceae.exe and rcpinspiraceaeHelper.exe--Google returned no hits on the (already sketchy) file names; the first was seemingly impossible to kill, and the second would restart moments after being terminated.  I found that the files were in a directory of the same name inside C:\\program files (x86)\\, along with some other noteworthy companions: files named httpsproxy.exe and certmgr.exe.  I uploaded the files to virustotal, (only 5/61 detected it, oddly), and tried to uninstall the program.  It was not listed under installed programs, nor was it on the list of programs to be run startup in msconfig.  Hrmm.  Digging a little deeper, i checked services in the system management console, and bingo, there it was, set to start automatically as a system service and automatically restart itself should it be killed.  After disabling the service and all fallback measures, the two processes no longer appeared to be running in taskmgr following a reboot.  However, the directory in which the files resided was mysteriously gone from C:\\program files (x86)\\ ...   \n  After going into tools -&gt; folder options -&gt; view and unchecking \"Hide protected operating system files\", the directory was visible again, and I was able to actually delete the files from the drive.  Never dealt with malware quite like this before.  Hope it helps.", "retrieved_utc": 1424842878, "updated_utc": 1668779261, "body_sha1": "a782a794d4db7b49e1576bfb1b53c5fbed881782", "nest_level": 1, "utc_datetime_str": "2015-01-16 15:49:00"}, {"author_flair_text": null, "distinguished": null, "score_hidden": false, "author_flair_css_class": null, "controversiality": 0, "downs": 0, "subreddit_id": "t5_2qrkp", "author": "bbarnes2112", "archived": false, "parent_id": 27557050460, "link_id": "t3_2skuq0", "subreddit": "Malware", "edited": false, "score": 2, "created_utc": 1421419774, "gilded": 0, "id": "cnqwm6v", "body": "did rombofix and regdelnulls.  I have D7II, i will give it a shot, Ill let you know the results.", "ups": 2, "retrieved_utc": 1424843760, "updated_utc": 1668779259, "body_sha1": "d3c1ba31b6041258fc5e94fd4fb366a858e45717", "utc_datetime_str": "2015-01-16 14:49:34"}, {"parent_id": 27556952049, "archived": false, "author": "bbarnes2112", "subreddit_id": "t5_2qrkp", "controversiality": 0, "downs": 0, "author_flair_css_class": null, "distinguished": null, "author_flair_text": null, "score_hidden": false, "ups": 1, "body": "Yep, checked with CC on a consistant basis.", "created_utc": 1421419410, "gilded": 0, "id": "cnqwfzj", "subreddit": "Malware", "score": 1, "edited": false, "link_id": "t3_2skuq0", "retrieved_utc": 1424843840, "updated_utc": 1668779259, "body_sha1": "0cfc1a1ab49e8f31ffd05cc9aad790d490d3f3c5", "utc_datetime_str": "2015-01-16 14:43:30"}, {"distinguished": null, "link_id": "t3_2skuq0", "downs": 0, "archived": false, "subreddit_id": "t5_2qrkp", "author_flair_text": null, "score_hidden": false, "gilded": 0, "edited": false, "controversiality": 0, "subreddit": "Malware", "parent_id": 27556562476, "body": "Besides, then what do you do if you come across this again? Just wipe and reinstall every time?? To each his or her own, but it's not my preference. I want to know what it is, how it got there, and how to remove it. I feel that malware removal is an important aspect of staying in control of technology.\n\nAlso, this is my goddamn OS, and it is not disposable! I will not reinstall because of some bastard's malicious code! haha That's my deal anyway. Granted, I also have my criteria for reinstalling, but it's always an absolute last resort.", "ups": 4, "author": "supertinyrobot", "author_flair_css_class": null, "id": "cnqrcwk", "score": 4, "created_utc": 1421401022, "retrieved_utc": 1424846293, "updated_utc": 1668779254, "body_sha1": "e3b2b34f5a2541c9aed6629952db96db3037e78a", "utc_datetime_str": "2015-01-16 09:37:02"}, {"created_utc": 1421400410, "score": 1, "author": "supertinyrobot", "author_flair_css_class": null, "id": "cnqr87w", "ups": 1, "body": "I'm jealous, in a way. Like you mentioned, it's a challenge. I get so bored with most malware these days, it's kind of nice to come across something truly difficult to remove. The first couple days of Poweliks, before I had research for my perusal, were the most exciting I've had in a while.\n\nAnyway, (aside from everything you've done already, of course) if you haven't run [Combofix](http://www.bleepingcomputer.com/download/combofix/) yet, I'd run that. (Not necessarily normally suggested, but you seem like you have a good idea what you're doing.) Reboot, hit it with a couple things again, Roguekiller, etc. to see what remains. Perhaps run [JRT](http://www.bleepingcomputer.com/download/junkware-removal-tool/) as well, since I didn't see it mentioned. Doesn't behave like Poweliks, but just for the hell of it I'd run [ESET's Poweliks Remover](http://kb.eset.com/esetkb/index?page=content&amp;id=SOLN2372). Um, the other thing that popped into my head that I'd probably fire up is [RegDelNull](http://technet.microsoft.com/en-us/sysinternals/bb897448.aspx). I'd certainly use [Autoruns](http://technet.microsoft.com/en-us/sysinternals/bb963902) as well to take a look at what's running. **The other thing I'd recommend is running [D7](http://www.majorgeeks.com/files/details/d7.html) and use MalwareScan (under Malware Removal) to take a good, deep look into the system.** D7 has a lot of nice features as well, that may come in handy. I think you mentioned something about policies, but I'd also use D7 to Remove Policies (under Malware Removal as well), as well as Delete Temp Files.\n\nOn the heels of Poweliks, I think it's easy to consider that this is achieving persistence primarily via the registry, which seems quite likely...and can clearly be a pain. The things is though, even Poweliks executed code, was evidenced by the behavior of dllhost and powershell. Basically, it was sneaky, but not undetectable. I wonder what this thing is doing. Is there any other behavioral evidence remaining? I wonder if you already removed whatever primary functionality was present and now some aspect of it is just doing what it thinks it should even though there's no purpose. haha Anyway, pretty intriguing. I hope I run across this in the shop.\n\nEDIT: Emphasis and formatting.\n\nEDIT2: Oh oh! Quick plug for [Malwarebytes Anti-Rootkit](https://www.malwarebytes.org/antirootkit/). That's helped me out a few times when others failed. Though, all things considered, I highly doubt it'll find anything.", "parent_id": null, "subreddit": "Malware", "controversiality": 0, "edited": true, "gilded": 0, "score_hidden": false, "author_flair_text": null, "subreddit_id": "t5_2qrkp", "archived": false, "downs": 0, "link_id": "t3_2skuq0", "distinguished": null, "retrieved_utc": 1424846354, "updated_utc": 1668779254, "body_sha1": "621f3860a69b6e9f540e9130d23b7f3566e0f80a", "edited_on": 1421401290, "nest_level": 1, "utc_datetime_str": "2015-01-16 09:26:50"}], "error": null, "metadata": {"es": {"took": 75, "timed_out": false, "_shards": {"total": 824, "successful": 824, "skipped": 820, "failed": 0}, "hits": {"total": {"value": 10, "relation": "eq"}, "max_score": null}}, "es_query": {"size": 10, "query": {"bool": {"must": [{"bool": {"must": [{"range": {"created_utc": {"gte": 1421395260000}}}, {"range": {"created_utc": {"lt": 1421481660000}}}]}}, {"bool": {"should": [{"match": {"subreddit": "malware"}}], "minimum_should_match": 1}}]}}, "aggs": {}, "sort": {"created_utc": "desc"}}, "es_query2": "{\"size\":10,\"query\":{\"bool\":{\"must\":[{\"bool\":{\"must\":[{\"range\":{\"created_utc\":{\"gte\":1421395260000}}},{\"range\":{\"created_utc\":{\"lt\":1421481660000}}}]}},{\"bool\":{\"should\":[{\"match\":{\"subreddit\":\"malware\"}}],\"minimum_should_match\":1}}]}},\"aggs\":{},\"sort\":{\"created_utc\":\"desc\"}}", "api_launch_time": 1673017478.2578893, "api_request_start": 1674103359.8750935, "api_request_end": 1674103360.0627193, "api_total_time": 0.18762588500976562}}